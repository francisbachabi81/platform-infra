# Proposed Structure Merge

- Front Door stack moved to **stacks/platform-app/frontdoor** and referenced via `module "frontdoor_stack"` in `stacks/platform-app/frontdoor_module.tf`.
- Relative module paths updated inside moved Front Door files ("../../modules" â†’ "../../../modules").
- ACR remains a **separate stack** to allow a **distinct Gov state storage account** (Gov-only deployment).
- Backend state split by product via GitHub Actions (`.github/workflows/env-deploy.yml`). ACR is special-cased to use its own Gov storage account for state.
- Future products: use `product` input; Gov products will automatically select the Gov backend.

## Tree

```
    README.md
    README_MERGE_NOTES.md
    .github/
        workflows/
            env-deploy.yml
    __MACOSX/
        ._README.md
        ._modules
        ._stacks
        modules/
            ._.DS_Store
            ._acr
            ._aks
            ._app-gateway
            ._cosmos-account
            ._frontdoor-profile
            ._keyvault
            ._network
            ._private-dns
            ._recovery-vault
            ._redis
            ._resource-group
            ._storage-account
            ._vnet
            ._vpn-gateway
            ._waf-policy
            acr/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            aks/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            app-gateway/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            cosmos-account/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            frontdoor-profile/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            keyvault/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            network/
                ._nsg
                ._peering
                nsg/
                    ._main.tf
                    ._outputs.tf
                    ._variables.tf
                peering/
                    ._main.tf
                    ._outputs.tf
                    ._variables.tf
            private-dns/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            recovery-vault/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            redis/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            resource-group/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            storage-account/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            vnet/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            vpn-gateway/
                ._main.tf
                ._outputs.tf
                ._variables.tf
            waf-policy/
                ._main.tf
                ._outputs.tf
                ._variables.tf
        stacks/
            ._.DS_Store
            ._platform-app
            frontdoor/
                ._.DS_Store
                ._backend.tf
                ._main.tf
                ._outputs.tf
                ._variables.tf
                tfvars/
                    ._.DS_Store
                    hrz/
                        ._.DS_Store
                        ._nonprod.tfvars
                        ._prod.tfvars
                    pub/
                        ._.DS_Store
                        ._nonprod.tfvars
                        ._prod.tfvars
            platform-app/
                ._.DS_Store
                ._tfvars
                tfvars/
                    ._.DS_Store
                    ._hrz
                    ._public
                    hrz/
                        ._.DS_Store
                        ._dev
                        ._prod
                        ._qa
                        dev/
                            ._.DS_Store
                        prod/
                            ._.DS_Store
                    public/
                        ._.DS_Store
                        ._dev
                        ._prod
                        ._qa
            shared-network/
                ._.DS_Store
                ._backend.tf
                ._main.tf
                ._outputs.tf
                ._tfvars
                ._variables.tf
                tfvars/
                    ._.DS_Store
                    hrz/
                        ._nonprod.tfvars
                        ._prod.tfvars
                    pub/
                        ._nonprod.tfvars
                        ._prod.tfvars
    envvars/
        dev.hrz.tfvars
        dev.pub.tfvars
        nonprod.tfvars
        prod.hrz.tfvars
        prod.pub.tfvars
        qa.hrz.tfvars
        qa.pub.tfvars
        uat.hrz.tfvars
        uat.pub.tfvars
    modules/
        .DS_Store
        acr/
            main.tf
            outputs.tf
            variables.tf
        aks/
            main.tf
            outputs.tf
            variables.tf
        app-gateway/
            main.tf
            outputs.tf
            variables.tf
        app-service-plan/
            main.tf
            outputs.tf
            variables.tf
        cosmos-account/
            main.tf
            outputs.tf
            variables.tf
        cosmosdb-postgresql/
            main.tf
            outputs.tf
            variables.tf
        dns-resolver/
            main.tf
            outputs.tf
            variables.tf
        event-hub/
            main.tf
            outputs.tf
            variables.tf
        event-hub-consumer-groups/
            main.tf
            outputs.tf
            variables.tf
        frontdoor-profile/
            main.tf
            outputs.tf
            variables.tf
        function-app/
            main.tf
            outputs.tf
            variables.tf
        keyvault/
            main.tf
            outputs.tf
            variables.tf
        network/
            nsg/
                main.tf
                outputs.tf
                variables.tf
            peering/
                main.tf
                outputs.tf
                variables.tf
        postgres-flex/
            main.tf
            outputs.tf
            variables.tf
        private-dns/
            main.tf
            outputs.tf
            variables.tf
        rbac/
            main.tf
            variables.tf
        recovery-vault/
            main.tf
            outputs.tf
            variables.tf
        redis/
            main.tf
            outputs.tf
            variables.tf
        resource-group/
            main.tf
            outputs.tf
            variables.tf
        servicebus/
            main.tf
            outputs.tf
            variables.tf
        storage-account/
            main.tf
            outputs.tf
            variables.tf
        vnet/
            main.tf
            outputs.tf
            variables.tf
        vpn-gateway/
            main.tf
            outputs.tf
            variables.tf
        waf-policy/
            main.tf
            outputs.tf
            variables.tf
    stacks/
        .DS_Store
        platform-app/
            .DS_Store
            .terraform.lock.hcl
            backend.tf
            frontdoor_module.tf
            main.tf
            outputs.tf
            tfplan-dev
            variables.tf
            .terraform/
                terraform.tfstate
                modules/
                    modules.json
                providers/
                    registry.terraform.io/
                        hashicorp/
                            azurerm/
                                4.9.0/
                                    darwin_arm64/
                                        LICENSE.txt
                                        terraform-provider-azurerm_v4.9.0_x5
                            random/
                                3.7.2/
                                    darwin_arm64/
                                        LICENSE.txt
                                        terraform-provider-random_v3.7.2_x5
            frontdoor/
                .DS_Store
                backend.tf
                main.tf
                outputs.tf
                variables.tf
                tfvars/
                    .DS_Store
                    hrz/
                        .DS_Store
                        nonprod.tfvars
                        prod.tfvars
                    pub/
                        .DS_Store
                        nonprod.tfvars
                        prod.tfvars
            tfvars/
                .DS_Store
                hrz/
                    .DS_Store
                    dev/
                        .DS_Store
                        dev.tfvars
                        secrets.manifest.json
                    prod/
                        .DS_Store
                        prod.tfvars
                        secrets.manifest.json
                    qa/
                        qa.tfvars
                        secrets.manifest.json
                    uat/
                        uat.tfvars
                public/
                    .DS_Store
                    dev/
                        dev.tfvars
                        secrets.manifest.json
                    prod/
                        prod.tfvars
                        secrets.manifest.json
                    qa/
                        qa.tfvars
                        secrets.manifest.json
                    uat/
                        uat.tfvars
        shared-network/
            .DS_Store
            backend.tf
            main.tf
            outputs.tf
            variables.tf
            tfvars/
                .DS_Store
                hrz/
                    nonprod.tfvars
                    prod.tfvars
                pub/
                    nonprod.tfvars
                    prod.tfvars
```
